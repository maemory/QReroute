/* ========================================================
 * NYC MTA Subway maps related javascript methods
 * ======================================================== */// Global Variables
function loadBar(){setTimeout(function(){$("#wrapper").fadeIn("slow")},1e3)}function setDataSet(){var e=document.getElementById("data-select"),t=e.options[e.selectedIndex].getAttribute("data-set");switch(t){case"SFMTA":ftidAgency="16PxVQOgn5DeBrLabBXEhAIwidDtl8wBfv_rTk-E";ftidShapes="1fowA6JsonMOGGxR8OIyuPcM8SqFZdGTDjI3ZLPM";ftidTrips="1i2meZFHYydHYiq_XoacNjIt8CIz2P2Z1yKpa4uI";ftidStops="1bSTnRcDDhv56Xw3DqvU65QfFT9a8uW7wGD0jXts";ftidRoutes="1uhXgYojzS6wEm-RoNC61EvPLrYI4fUdVi2Qq26k";ftidCalendar="1iPE4A40RRzxityVSZ6wIjI4PDCvj4Gsw8W9J-AY";dataCenter=new google.maps.LatLng(37.739348,-122.457809);break;case"CTA":ftidShapes="1y26_NR7wKqdAOYC_ynnL452Qp3RRVHPz4qLv1dc";ftidTrips="1p2Ux_tIBUN-x3iwQI_kIzcrPnVQlCKJnQYuoDhU";ftidStops="18r6CB0BVprQb_4ZRIGlZNg-GwJ7Jo6AYkJbnNrE";ftidRoutes="1EW4TvRx8HutyqPENC4BfvE_m3sWIQWflPPkn-NE";ftidCalendar="1M69-7yIhvSKnkb_409CmpJVN19aCBttEyrr9_TU";ftidAgency="1d1Wu3tjK-S0FVss2cEDr_ErY5GCUYS2zi1i-57A";dataCenter=new google.maps.LatLng(41.9,-87.7);break;case"BART":ftidShapes="1qhG923HlIE33kN39Uj9ynv0zfUZ_DmERytAvsN8";ftidTrips="1XQTqk31yI9XsPGWWcQuB_QVHw33koeP55rIWN0Q";ftidStops="1eHY-ncMWzJiOanfeFFytceidCkfsnvISnPRWNLw";ftidRoutes="1g6n7qZVyxWyxArzOvpSbho-yuxucaj81tv3GJMA";ftidCalendar="15bcav2--Oybrj0bYRGfLDEowF13lOiQXTUpDjeo";dataCenter=new google.maps.LatLng(37.739348,-122.457809);break;case"WMATA":ftidAgency="1bjS6HvbI3JtOwMP8tF1_KmDE5MG26iFlaYqlQzg";ftidShapes="1Cf5SCbFXXKlTZyiGvkMou6cxdSmPe_NE_vaPS5M";ftidTrips="1RiLbpdFVi_rrtBMSENnxbBkCqW8IbiRZb9vZAx4";ftidStops="1BclmGuWcVE3KHbrrGUt6vsswv5g1RNXvq3Nl66E";ftidRoutes="1NGIa4kK32rU7xnAIabsPoxCSj2-lTtFyTQxV0b8";ftidCalendar="1bdhWPvQy4nE5rlfWa2LXmfOgIKVbstVf1158qec";dataCenter=new google.maps.LatLng(38.883825,-76.928735);break;case"MTA":default:ftidAgency="11e7oGJETz29YKIf71LJha8jNSyXVYj5VyVhOEWo";ftidShapes="1i2RNtijNTRAaoFMjbUX1wMo3smc2nQkAsCRfPBk";ftidTrips="1I_yESx3I_Xet3JEM2l0DWHj76cu_gsx7vw2YYXM";ftidStops="17Y_13i04CsvoEVpm7qgQ4SpxJbl8K9c4u1vyVo0";ftidRoutes="1nWHP5FJs_aPvCPDYYkG0GHHojbkvZDdjcnjoTfw";ftidCalendar="1wetKxVGhNZKw0P294iWNvkRGkZTTaOypDWi9b34";dataCenter=new google.maps.LatLng(40.753357,-73.984375)}dispAgencyInfo();$(".sel-city").remove();$("#route-select").fadeIn("slow");$("#extra-select").fadeOut("fast");$("#init-text").fadeOut("fast")}function printGlobals(){console.log("selected route_id: ",selRouteId);console.log("selected day of service: ",selDay);console.log("selected service_id: ",selServiceId);console.log("selected shape_id: ",selShapeId);console.log("selected trip_id: ",selTripId)}function initializeMap(){var e={center:dataCenter,zoom:11,streetViewControl:!1,panControl:!1,mapTypeId:google.maps.MapTypeId.HYBRID};map=new google.maps.Map(document.getElementById("map_canvas"),e);transitLayer=new google.maps.TransitLayer;uniqueRouteId()}function uniqueRouteId(){function t(e){$(".route-option").remove();var t=e.rows,n=document.getElementById("route-select"),r=document.createElement("option");r.innerHTML="Select Route";r.className="route-option sel-route";n.appendChild(r);for(var i in t){var s=t[i][0],o=t[i][1].toLowerCase().toTitleCase(),u=t[i][2].toLowerCase().toTitleCase(),a=t[i][3];if(s.length>0){var r=document.createElement("option");u.length>0&&o.length>0?r.innerHTML=o+": "+u:u.length>0?r.innerHTML=u:o.length>0?r.innerHTML=o:r.innerHTML=s;r.setAttribute("data-routeId",s);a.length>0?r.setAttribute("data-color",a):r.setAttribute("data-color","03389C");r.className="route-option";n.appendChild(r)}}}var e="SELECT 'route_id','route_short_name','route_long_name','route_color' FROM "+ftidRoutes+" LIMIT 1000";queryTable(e,"jsonp",t)}function setRouteId(){var e=document.getElementById("route-select");selRouteId=e.options[e.selectedIndex].getAttribute("data-routeId");selRouteColor=e.options[e.selectedIndex].getAttribute("data-color");$(".sel-route").remove();var t=document.getElementById("heading-select"),n=document.createElement("option");n.innerHTML="Select Direction";n.className="heading-option sel-headsign";t.appendChild(n);dispRouteInfo(selRouteId);$("#extra-select").fadeIn("slow")}function setDay(){var e=document.getElementById("day-select"),t=e.selectedIndex;switch(t){case 1:selDay="tuesday";break;case 2:selDay="wednesday";break;case 3:selDay="thursday";break;case 4:selDay="friday";break;case 5:selDay="saturday";break;case 6:selDay="sunday";break;default:selDay="monday"}}function setServiceId(){function i(e){var t=e.rows;for(var r in t){var i=t[r][0];i.length>0&&n.push(i)}constructServiceId(n);$("#heading-select").fadeIn("fast")}clearHeadingSelect();var e=document.getElementById("heading-select"),t=document.createElement("option");t.innerHTML="Select Heading";t.className="heading-option sel-headsign";e.appendChild(t);var n=new Array,r="SELECT 'service_id'  FROM "+ftidCalendar+" WHERE '"+selDay+"'='1'"+" GROUP BY 'service_id'"+" LIMIT 100";queryTable(r,"jsonp",i)}function constructServiceId(e){for(var t in e){var n="SELECT 'service_id','shape_id','trip_headsign'  FROM "+ftidTrips+" WHERE 'route_id'='"+selRouteId+"' AND "+"'service_id'='"+e[t]+"'"+" GROUP BY 'service_id','shape_id','trip_headsign'"+" LIMIT 50";queryTable(n,"jsonp",r);function r(e){var t=e.rows;for(var n in t){var r=t[n][0],i=t[n][1],s=t[n][2].toLowerCase().toTitleCase(),o=document.getElementById("heading-select");if(r.length>0&&i.length>0&&s.length>0){selServiceId=r;var u=document.createElement("option");u.innerHTML=s;u.className="heading-option";u.setAttribute("data-shapeId",i);o.appendChild(u)}else if(r.length>0&&i.length>0){selServiceId=r;var u=document.createElement("option");u.innerHTML=selRouteId+" ("+r+")";u.className="heading-option";u.setAttribute("data-shapeId",i);o.appendChild(u)}}}}}function setShapeId(){var e=document.getElementById("heading-select");selShapeId=e.options[e.selectedIndex].getAttribute("data-shapeId");$(".sel-headsign").remove()}function plotShapeId(){clearPolylines(routes);cleanPolylines(routes);clearPolylines(backgroundRoutes);cleanPolylines(backgroundRoutes);addPolyline(selShapeId,selRouteColor);plotPolylines(backgroundRoutes,map);plotPolylines(routes,map)}function uniqueShapeId(){function t(e){var t=e.rows;if(t===null)alert("No data received");else{var n=document.getElementById("shape-select");for(var r in t){var i=t[r][0];if(i.length>0){var s=document.createElement("option");s.innerHTML=i;s.className="select-disp";n.appendChild(s)}}}}var e="SELECT 'shape_id' FROM "+ftidTrips+" GROUP BY 'shape_id'"+" LIMIT 10";queryTable(e,"jsonp",t)}function uniqueTripId(){function t(e){var t=e.rows,n=document.getElementById("shape-select");for(var r in t){var i=t[r][0];if(i.length>0){var s=document.createElement("option");s.innerHTML=i;s.className="select-disp";n.appendChild(s)}}}var e="SELECT 'trip_id' FROM "+ftidStopTimes+" GROUP BY 'trip_id'"+" LIMIT 5";queryTable(e,"jsonp",t)}function uniqueServiceId(){function t(e){var t=e.rows,n=document.getElementById("shape-select");for(var r in t){var i=t[r][0];if(i.length>0){var s=document.createElement("option");s.innerHTML=i;s.className="select-disp";n.appendChild(s)}}}var e="SELECT 'service_id' FROM "+ftidTrips+" GROUP BY 'service_id'"+" LIMIT 50";queryTable(e,"jsonp",t)}function addPolyline(e,t){function f(e){var t=e.rows,n=document.getElementById("ft-data");for(var r in t){var i=t[r][0],s=t[r][1];u.push(new google.maps.LatLng(i,s));o.push(new google.maps.LatLng(i,s))}}var n={strokeColor:"#"+t,strokeOpacity:1,strokeWeight:2},r={strokeColor:"#FFFFFF",strokeOpacity:1,strokeWeight:4},i=new google.maps.Polyline(r),s=new google.maps.Polyline(n),o=i.getPath(),u=s.getPath(),a="SELECT 'shape_pt_lat','shape_pt_lon' FROM "+ftidShapes+" WHERE 'shape_id'='"+e+"'"+" ORDER BY 'shape_pt_sequence'"+"LIMIT 5000";queryTable(a,"jsonp",f);google.maps.event.addListener(s,"mouseover",function(){s.setOptions({strokeWeight:3.5})});google.maps.event.addListener(s,"mouseout",function(){s.setOptions({strokeWeight:2})});backgroundRoutes.push(i);routes.push(s)}function dispAgencyInfo(){function t(e){var t=document.getElementById("info-data"),n=e.rows;console.log("agency info: ",n);for(i in n){var r=n[i][0].toLowerCase().toTitleCase(),s=n[i][1];r.length>0&&addDlListItems("Agency",r,"bottomInfo",t);s.length>0&&addDlListItems("Website",s,"bottomInfo",t,"link")}$("#bottom-data").fadeIn("fast");setTimeout(function(){$("#bottom-data").fadeOut("2000")},5e3)}clearBottomInfo();var e="SELECT 'agency_name','agency_url' FROM "+ftidAgency+" LIMIT 5";queryTable(e,"jsonp",t)}function dispRouteInfo(e){function n(e){var t=document.getElementById("info-data"),n=e.rows;for(i in n){var r=n[i][0],s=n[i][1].toLowerCase().toTitleCase(),o=n[i][2].toLowerCase().toTitleCase(),u=n[i][3],a=n[i][4];s.length>0&&o.length>0?addDlListItems("Route",s+": "+o,"bottomInfo",t):o.length>0?addDlListItems("Route",o,"bottomInfo",t):s.length>0?addDlListItems("Route",s,"bottomInfo",t):addDlListItems("Route",RouteId,"bottomInfo",t);u.length>0&&addDlListItems("Description",u,"bottomInfo",t);a.length>0&&addDlListItems("Website",a,"bottomInfo",t,"link")}$("#bottom-data").fadeIn("fast");setTimeout(function(){$("#bottom-data").fadeOut("2000")},5e3)}clearBottomInfo();var t="SELECT 'route_id','route_short_name','route_long_name','route_desc','route_url' FROM "+ftidRoutes+" WHERE 'route_id'='"+e+"'"+"LIMIT 1";queryTable(t,"jsonp",n)}function clearBottomInfo(){$(".bottomInfo").remove()}function clearHeadingSelect(){$(".heading-option").remove();$("#heading-select").fadeOut("fast")}function toggleTransit(){transitLayer.setMap(transitLayer.getMap()?null:map)}var map,transitLayer,markers=[],routes=[],backgroundRoutes=[],services=[],dataCenter,selRouteId,selRouteColor,selServiceId,selTripId,selShapeId,selDay="monday";String.prototype.toTitleCase=function(){var e=/^(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|vs?\.?|via)$/i;return this.replace(/([^\W_]+[^\s-]*) */g,function(t,n,r,i){return r>0&&r+n.length!==i.length&&n.search(e)>-1&&i.charAt(r-2)!==":"&&i.charAt(r-1).search(/[^\s-]/)<0?t.toLowerCase():n.substr(1).search(/[A-Z]|\../)>-1?t:t.charAt(0).toUpperCase()+t.substr(1)})};